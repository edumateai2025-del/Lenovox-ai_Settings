<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Settings â€¢ Lenovox AI</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 20px;
}
.container {
  max-width: 420px;
  margin: auto;
  background: white;
  padding: 25px;
  border-radius: 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}
h2 {
  text-align: center;
  margin-bottom: 20px;
}
.profile {
  text-align: center;
}
.profile img {
  width: 110px;
  height: 110px;
  border-radius: 50%;
  object-fit: cover;
  cursor: pointer;
  border: 3px solid #32a852;
  transition: 0.3s;
}
.profile img:hover {
  transform: scale(1.05);
}
input, select, button {
  width: 100%;
  margin-top: 12px;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 15px;
}
button {
  background: #32a852;
  color: white;
  border: none;
  font-weight: bold;
  cursor: pointer;
}
button:hover {
  opacity: 0.9;
}
.logout {
  background: #000;
  margin-top: 20px;
}
small {
  display: block;
  text-align: center;
  color: #666;
  margin-top: 10px;
}
.dark {
  background: #111;
  color: white;
}
.dark .container {
  background: #1c1c1c;
}
</style>
</head>

<body>

<div class="container">
  <h2>Settings</h2>

  <div class="profile">
    <img id="avatar" src="https://i.postimg.cc/MTd0xxGM/grok-1767825639177-1.jpg">
    <input type="file" id="photo" accept="image/*" hidden>
    <small>Tap image to change</small>
  </div>

  <input type="text" id="username" placeholder="Username" disabled>
  <input type="text" id="name" placeholder="Full Name">
  <input type="number" id="age" placeholder="Age">

  <select id="theme">
    <option value="">Select Theme</option>
    <option value="light">Light</option>
    <option value="dark">Dark</option>
  </select>

  <button onclick="saveSettings()">Save Settings</button>
  <button class="logout" onclick="logout()">Log Out</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDnANsKUAZ1giXXdo-fKkFneMuKh0l0FCg",
  authDomain: "edumateai-6544b.firebaseapp.com",
  projectId: "edumateai-6544b",
  storageBucket: "edumateai-6544b.appspot.com",
  messagingSenderId: "445949748647",
  appId: "1:445949748647:web:40bee0e792098333fa4282"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

const avatar = document.getElementById("avatar");
const photoInput = document.getElementById("photo");
const nameInput = document.getElementById("name");
const ageInput = document.getElementById("age");
const themeSelect = document.getElementById("theme");
const usernameInput = document.getElementById("username");

avatar.onclick = () => photoInput.click();

// Apply theme helper
function applyTheme(theme) {
  if (theme === "dark") {
    document.body.classList.add("dark");
  } else {
    document.body.classList.remove("dark");
  }
}

// Fetch user info if logged in
auth.onAuthStateChanged(user => {
  const uid = user ? user.uid : null;
  const autoUsername = uid ? "user_" + uid.slice(0, 6) : "guest";
  usernameInput.value = autoUsername;

  if (uid) {
    db.collection("users").doc(uid).get().then(doc => {
      if (doc.exists) {
        const d = doc.data();
        nameInput.value = d.name || "";
        ageInput.value = d.age || "";
        themeSelect.value = d.theme || "";
        if (d.photo) avatar.src = d.photo;
        applyTheme(d.theme);
      }
    });
  }
});

// Preview selected photo
photoInput.addEventListener("change", e => {
  const file = e.target.files[0];
  if (file) avatar.src = URL.createObjectURL(file);
});

// Save settings
function saveSettings() {
  const user = auth.currentUser;
  if (!user) {
    alert("Please log in to save your settings.");
    return;
  }

  const file = photoInput.files[0];
  const data = {
    name: nameInput.value,
    age: ageInput.value,
    theme: themeSelect.value,
    username: usernameInput.value
  };

  applyTheme(themeSelect.value);

  if (file) {
    const ref = storage.ref("profiles/" + user.uid + ".jpg");
    ref.put(file).then(() => {
      ref.getDownloadURL().then(url => {
        data.photo = url;
        db.collection("users").doc(user.uid).set(data, { merge: true });
        alert("Settings saved");
      });
    });
  } else {
    db.collection("users").doc(user.uid).set(data, { merge: true });
    alert("Settings saved");
  }
}

// Logout
function logout() {
  auth.signOut().then(() => {
    // Optional: Just show settings as guest instead of redirect
    alert("You are logged out. Please log in to save changes.");
  });
}
</script>

</body>
</html>
